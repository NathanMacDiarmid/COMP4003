/* This is a sample static Embedded SQL program. In order to run it,
   You need to do the following. 

1.	Edit this file with correct oracle username and password 
2.	proc cursor.pc
3.	gcc -c cursor.c -I/u06/oracle11g/precomp/public -m64
4.	gcc -o cursor cursor.o -L/u06/oracle11g/lib -lclntsh \
	-R/u06/oracle11g/lib -m64
5.	cursor
6.	You will get error message if you don't have table student
	in your database. 
---------------------------
0.	you can create it as follows:
.	run sqlplus
7. SQL>	create table student (
         S# char(4),
         sname varchar(10),
         age integer,
         primary key (s#)
        );
8. SQL>	insert into student 
	values ('1000', 'John', 25);
   SQL> insert into student
	values ('2000', 'Mary', 30);
   SQL> insert into student
	values ('3000', 'Jack', 30);
   SQL> exit; 	
*/
	
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

exec sql include sqlca;
exec sql begin declare section;
         char sno[4];
         char sname[20];
         int  age;
         char *username= "fedora";
         char *password= "oracle";
exec sql end declare section;
 
exec sql declare s_cursor cursor for
         select *
         from Student;
 
exec sql whenever sqlerror goto error;
exec sql whenever not found goto done;

int main()
{
    exec sql connect :username identified by :password;
    printf("Connected to ORACLE\n");

    exec sql begin declare section;
    // tables
    char customer_table[1024];
    char order_table[1024];
    char line_item_table[1024];
    char product_table[1024];

    // inserts
    char Smith[1024];
    char Smith_cno[5];
    char Smith_name[10];
    char Smith_address[10];

    char Jones[1024];
    char Jones_cno[5];
    char Jones_name[10];
    char Jones_address[10];

    char Blake[1024];
    char Blake_cno[5];
    char Blake_name[10];
    char Blake_address[10];

    char Clark[1024];
    char Clark_cno[5];
    char Clark_name[10];
    char Clark_address[10];

    char MacDiarmid[1024];
    char MacDiarmid_cno[5];
    char MacDiarmid_name[10];
    char MacDiarmid_address[10];
    exec sql end declare section;

    // tabes
    strcpy(customer_table, "create table customer (C# char(10) primary key, Name varchar(10), Address varchar(10))");
    strcpy(order_table, "create table order_t (O# char(10) primary key, O_Date varchar(10), Total_Price varchar(10))");
    strcpy(line_item_table, "create table line_item (I# char(10) primary key, Qty varchar(10))");
    strcpy(product_table, "create table product (P# char(10) primary key, Name varchar(10), Price varchar(10))");

    // inserts
    strcpy(Smith, "insert into customer values ('1', 'Smith', '1125 Colonel By Dr')");

    exec sql set transaction read write;

    exec sql execute immediate :customer_table;
    exec sql execute immediate :order_table;
    exec sql execute immediate :line_item_table;
    exec sql execute immediate :product_table;

    exec sql prepare s from :Smith;
    exec sql execute s using :Smith_cno, :Smith_name, :Smith_address;

    exec sql commit release;
 
    exec sql open s_cursor;
    printf("Cursor opened\n");
 
    printf("S#    SNAME                        AGE \n");
    printf("----- -------------------- ------------\n");
 
    while(1) {
        exec sql fetch s_cursor
        into :sno, :sname, :age;
        printf("%4s  %10s %11d\n", sno, sname, age);
    }
    done:
    printf("----- -------------------- ------------\n");
    exec sql close s_cursor;
    exec sql commit release;
    printf("Work is done successfully!\n");
    exit(0);
 
    error:
    printf("SQL errors!\n");
    exec sql rollback release;
    exit(1);
}
 
